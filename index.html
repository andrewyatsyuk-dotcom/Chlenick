<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>üç™ –ü–µ—á–∏–≤–æ-–ö–ª—ñ–∫–µ—Ä</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
      --card: rgba(255,255,255,0.95);
      --accent: #ff6b6b;
      --text: #2d3436;
      --gold: #fdcb6e;
    }
    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      min-height: 100vh;
      background: var(--bg);
      color: var(--text);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      overflow-x: hidden;
    }
    h1 {
      font-size: 1.5rem;
      margin-bottom: 8px;
      text-align: center;
      color: white;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .score-card {
      background: var(--card);
      border-radius: 16px;
      padding: 16px 24px;
      margin-bottom: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.15);
      text-align: center;
    }
    .score-label { font-size: 0.85rem; opacity: 0.7; }
    .score-value { font-size: 1.4rem; font-weight: 900; color: var(--gold); }
    .score-value span { font-size: 0.95rem; opacity: 0.9; }
    .score-value.sugar { color: #a29bfe; }
    .score-value.gold { color: #fdcb6e; }
    .currencies { display: flex; flex-wrap: wrap; gap: 12px 20px; justify-content: center; margin-bottom: 4px; }
    .curr { text-align: center; }
    .curr .score-label { font-size: 0.7rem; }
    .per-sec { font-size: 0.8rem; color: #00b894; margin-top: 4px; }

    .clicker {
      width: 180px;
      height: 180px;
      background: linear-gradient(145deg, #ffeaa7, #fdcb6e);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 5rem;
      cursor: pointer;
      user-select: none;
      box-shadow: 0 10px 40px rgba(253,203,110,0.5);
      transition: transform 0.08s;
      margin: 20px 0;
      border: 6px solid #f9ca24;
      -webkit-tap-highlight-color: transparent;
    }
    .clicker:active { transform: scale(0.92); }

    .shop {
      width: 100%;
      max-width: 340px;
      background: var(--card);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.15);
    }
    .shop h2 { font-size: 1rem; margin-bottom: 12px; opacity: 0.8; }
    .upgrade {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      margin-bottom: 8px;
      background: #f8f9fa;
      border-radius: 12px;
      transition: background 0.2s;
    }
    .upgrade:last-child { margin-bottom: 0; }
    .upgrade:hover { background: #f1f3f5; }
    .upgrade-info { flex: 1; }
    .upgrade-name { font-weight: 700; font-size: 0.95rem; }
    .upgrade-desc { font-size: 0.75rem; opacity: 0.6; }
    .upgrade-stats { font-size: 0.8rem; color: #00b894; font-weight: 600; }
    .upgrade-btn {
      padding: 10px 16px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      border: none;
      border-radius: 10px;
      color: white;
      font-weight: 700;
      font-size: 0.85rem;
      cursor: pointer;
      transition: transform 0.1s;
    }
    .upgrade-btn:active { transform: scale(0.95); }
    .upgrade-btn:disabled {
      background: #b2bec3;
      cursor: not-allowed;
      transform: none;
    }

    .floating-coin {
      position: fixed;
      pointer-events: none;
      font-size: 1.5rem;
      animation: floatUp 0.8s ease-out forwards;
      z-index: 100;
    }
    @keyframes floatUp {
      0% { opacity: 1; transform: translateY(0) scale(1); }
      100% { opacity: 0; transform: translateY(-80px) scale(1.5); }
    }

    .tabs { display: flex; gap: 8px; margin-bottom: 12px; }
    .tab { padding: 10px 16px; border: none; border-radius: 12px; background: rgba(255,255,255,0.3); color: white; font-weight: 700; cursor: pointer; transition: all 0.2s; }
    .tab.active { background: white; color: #667eea; }
    .tab:hover:not(.active) { background: rgba(255,255,255,0.5); }

    .view { display: none; width: 100%; max-width: 340px; }
    .view.active { display: flex; flex-direction: column; align-items: center; }

    .newbie-badge {
      background: linear-gradient(135deg, #00b894, #00cec9);
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .lb-list { width: 100%; background: var(--card); border-radius: 16px; overflow: hidden; box-shadow: 0 8px 32px rgba(0,0,0,0.1); }
    .lb-row { display: flex; align-items: center; padding: 12px 16px; border-bottom: 1px solid #eee; gap: 12px; }
    .lb-row:last-child { border-bottom: none; }
    .lb-row.me { background: rgba(102,126,234,0.15); }
    .lb-rank { font-size: 1.2rem; font-weight: 900; width: 36px; text-align: center; }
    .lb-rank.gold { color: #fdcb6e; }
    .lb-rank.silver { color: #b2bec3; }
    .lb-rank.bronze { color: #e17055; }
    .lb-name { flex: 1; font-weight: 600; }
    .lb-score { font-weight: 800; color: var(--gold); }
    .lb-empty { padding: 24px; text-align: center; opacity: 0.6; }
    .lb-refresh { width: 100%; padding: 12px; margin-top: 8px; background: linear-gradient(135deg, #667eea, #764ba2); border: none; border-radius: 12px; color: white; font-weight: 700; cursor: pointer; }
  </style>
</head>
<body>
  <h1>üç™ –ü–µ—á–∏–≤–æ-–ö–ª—ñ–∫–µ—Ä</h1>
  <p style="color: rgba(255,255,255,0.9); font-size: 0.9rem; margin-bottom: 8px;">–¢–∞–ø–∞–π –ø–µ—á–∏–≤–æ, –∑–±–∏—Ä–∞–π –º–æ–Ω–µ—Ç–∏!</p>

  <div class="tabs">
    <button class="tab active" onclick="switchTab('game')">üéÆ –ì—Ä–∞</button>
    <button class="tab" onclick="switchTab('global')">üèÜ –ì–ª–æ–±–∞–ª—å–Ω–∏–π —Ç–æ–ø</button>
  </div>

  <div id="view-game" class="view active">
  <div id="newbie-badge" class="newbie-badge" style="display:none;">üöÄ –ë–æ–Ω—É—Å –Ω–æ–≤–∞—á–∫–∞: √ó2 –¥–æ –≤–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–∞!</div>
  <div class="score-card">
    <div class="currencies">
      <div class="curr"><span class="score-label">–ü–µ—á–∏–≤–∞</span><div class="score-value"><span id="cookies">0</span> üç™</div></div>
      <div class="curr"><span class="score-label">–¶—É–∫–æ—Ä</span><div class="score-value sugar"><span id="sugar">0</span> üßÇ</div></div>
      <div class="curr"><span class="score-label">–ó–æ–ª–æ—Ç–æ</span><div class="score-value gold"><span id="gold">0</span> üíõ</div></div>
    </div>
    <div class="per-sec">+<span id="per-sec">0</span> üç™/—Å–µ–∫</div>
  </div>

  <div class="clicker" id="cookie" onclick="clickCookie()">üç™</div>

  <div class="shop">
    <h2>üõí –ö—Ä–∞–º–Ω–∏—Ü—è</h2>
    <div id="upgrades"></div>
  </div>
  </div>

  <div id="view-global" class="view">
    <h2 style="margin-bottom:12px;color:white;">üèÜ –ì–ª–æ–±–∞–ª—å–Ω–∏–π —Ç–æ–ø</h2>
    <div class="lb-list"><div id="lb-global" class="lb-empty">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div></div>
    <button class="lb-refresh" onclick="loadLeaderboard('global')">üîÑ –û–Ω–æ–≤–∏—Ç–∏</button>
  </div>

  <script>
    const LS_KEY = 'cookie_clicker_v3';
    const FIREBASE_URL = 'https://leaderboardcookie-default-rtdb.firebaseio.com';  // https://YOUR_PROJECT-default-rtdb.firebaseio.com

    let state = {
      cookies: 0,
      sugar: 0,
      gold: 0,
      perSec: 0,
      sugarPerSec: 0,
      goldPerSec: 0,
      fingers: 0,
      cursors: 0,
      grandmas: 0,
      bakers: 0,
      farms: 0,
      mines: 0,
      factories: 0,
      lastSave: Date.now(),
      firstPlay: Date.now(),
      totalEarned: 0
    };

    let userId = 'anon_' + Math.random().toString(36).slice(2, 10);
    let userName = '–ì—Ä–∞–≤–µ—Ü—å';

    const upgrades = [
      { id: 'fingers', name: 'üëÜ –ü–∞–ª—å—á–∏–∫', desc: '–¢–∏ –Ω–∞—Ç–∏—Å–∫–∞—î—à —Å–∞–º', cost: 0, costSugar: 0, costGold: 0, costMult: 1.2, prod: 0.01, sugarProd: 0, goldProd: 0, key: 'fingers', max: 1 },
      { id: 'cursors', name: 'üñ±Ô∏è –ö—É—Ä—Å–æ—Ä', desc: '–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–ª–∏–∫–∞—î', cost: 15, costSugar: 0, costGold: 0, costMult: 1.15, prod: 0.1, sugarProd: 0, goldProd: 0, key: 'cursors' },
      { id: 'grandmas', name: 'üëµ –ë–∞–±—É—Å—è', desc: '–ü–µ—á–µ –ø–µ—á–∏–≤–æ –≤–¥–æ–º–∞', cost: 100, costSugar: 0, costGold: 0, costMult: 1.15, prod: 1, sugarProd: 0, goldProd: 0, key: 'grandmas' },
      { id: 'bakers', name: 'üßë‚Äçüç≥ –ü–µ–∫–∞—Ä', desc: '–ü–µ—á–µ —É –ø–µ—á—ñ', cost: 500, costSugar: 0, costGold: 0, costMult: 1.15, prod: 4, sugarProd: 0, goldProd: 0, key: 'bakers' },
      { id: 'farms', name: 'üåæ –§–µ—Ä–º–∞', desc: '–ü—à–µ–Ω–∏—Ü—è —ñ —Ü—É–∫–æ—Ä', cost: 1200, costSugar: 0, costGold: 0, costMult: 1.15, prod: 8, sugarProd: 2, goldProd: 0, key: 'farms' },
      { id: 'mines', name: '‚õèÔ∏è –®–∞—Ö—Ç–∞', desc: '–¶—É–∫–æ—Ä –∑ —Ü—É–∫—Ä–æ–≤–æ—ó —Ç—Ä–æ—Å—Ç–∏–Ω–∏', cost: 5000, costSugar: 50, costGold: 0, costMult: 1.15, prod: 47, sugarProd: 5, goldProd: 0, key: 'mines' },
      { id: 'factories', name: 'üè≠ –§–∞–±—Ä–∏–∫–∞', desc: '–ú–∞—Å–æ–≤–µ –≤–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–æ –ø–µ—á–∏–≤–∞', cost: 20000, costSugar: 200, costGold: 0, costMult: 1.15, prod: 260, sugarProd: 10, goldProd: 1, key: 'factories' }
    ];

    const NEWBIE_THRESHOLD = 5000;
    const NEWBIE_DAYS = 3;

    function save() {
      state.lastSave = Date.now();
      localStorage.setItem(LS_KEY, JSON.stringify(state));
    }

    function load() {
      try {
        const d = localStorage.getItem(LS_KEY);
        if (d) {
          const loaded = JSON.parse(d);
          state = { ...state, ...loaded };
          const offlineSec = Math.min((Date.now() - state.lastSave) / 1000, 86400);
          const ps = state.perSec || 0, ss = state.sugarPerSec || 0, gs = state.goldPerSec || 0;
          state.cookies += ps * offlineSec;
          state.sugar = (state.sugar || 0) + ss * offlineSec;
          state.gold = (state.gold || 0) + gs * offlineSec;
          state.totalEarned = (state.totalEarned || 0) + ps * offlineSec;
        }
      } catch(e) {}
    }

    function getNewbieMultiplier() {
      const total = state.totalEarned || 0;
      const daysSince = (Date.now() - (state.firstPlay || Date.now())) / (24 * 3600000);
      if (total < NEWBIE_THRESHOLD || daysSince < NEWBIE_DAYS) return 2;
      if (total < NEWBIE_THRESHOLD * 2 || daysSince < NEWBIE_DAYS * 2) return 1.5;
      return 1;
    }

    function calcPerSec() {
      let cookieTotal = 0, sugarTotal = 0, goldTotal = 0;
      upgrades.forEach(u => {
        const n = state[u.key] || 0;
        cookieTotal += n * u.prod;
        sugarTotal += n * (u.sugarProd || 0);
        goldTotal += n * (u.goldProd || 0);
      });
      const mult = getNewbieMultiplier();
      state.perSec = cookieTotal * mult;
      state.sugarPerSec = sugarTotal;
      state.goldPerSec = goldTotal;
    }

    function getCost(upgrade) {
      const count = state[upgrade.key] || 0;
      const mult = Math.pow(upgrade.costMult, count);
      return {
        cookies: Math.floor(upgrade.cost * mult),
        sugar: Math.floor((upgrade.costSugar || 0) * mult),
        gold: Math.floor((upgrade.costGold || 0) * mult)
      };
    }

    function clickCookie() {
      state.cookies += 1;
      state.totalEarned = (state.totalEarned || 0) + 1;
      haptic();
      showFloating('+1');
      save();
      updateUI();
    }

    function buyUpgrade(upgrade) {
      const cost = getCost(upgrade);
      const max = upgrade.max != null ? upgrade.max : Infinity;
      if ((state[upgrade.key] || 0) >= max) return;
      if (state.cookies < cost.cookies || state.sugar < cost.sugar || state.gold < cost.gold) return;
      state.cookies -= cost.cookies;
      state.sugar -= cost.sugar;
      state.gold -= cost.gold;
      state[upgrade.key] = (state[upgrade.key] || 0) + 1;
      calcPerSec();
      haptic();
      save();
      renderUpgrades();
      updateUI();
    }

    function showFloating(text) {
      const el = document.createElement('div');
      el.className = 'floating-coin';
      el.textContent = text;
      el.style.left = (window.innerWidth / 2 - 20 + (Math.random() - 0.5) * 40) + 'px';
      el.style.top = '45%';
      document.body.appendChild(el);
      setTimeout(() => el.remove(), 800);
    }

    function haptic() {
      try {
        if (window.Telegram?.WebApp?.HapticFeedback) {
          window.Telegram.WebApp.HapticFeedback.impactOccurred('light');
        } else if (navigator.vibrate) navigator.vibrate(20);
      } catch(e) {}
    }

    function format(n) {
      if (n >= 1e9) return (n / 1e9).toFixed(1) + 'B';
      if (n >= 1e6) return (n / 1e6).toFixed(1) + 'M';
      if (n >= 1e3) return (n / 1e3).toFixed(1) + 'K';
      return Math.floor(n).toString();
    }

    function costStr(c) {
      const parts = [];
      if (c.cookies > 0) parts.push(format(c.cookies) + ' üç™');
      if (c.sugar > 0) parts.push(format(c.sugar) + ' üßÇ');
      if (c.gold > 0) parts.push(format(c.gold) + ' üíõ');
      return parts.length ? parts.join(' + ') : '–±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ';
    }

    function renderUpgrades() {
      document.getElementById('upgrades').innerHTML = upgrades.map(u => {
        const count = state[u.key] || 0;
        const cost = getCost(u);
        const atMax = u.max != null && count >= u.max;
        const canBuy = !atMax && state.cookies >= cost.cookies && state.sugar >= cost.sugar && state.gold >= cost.gold;
        let stats = '+' + u.prod + ' üç™/—Å';
        if (u.sugarProd) stats += ', +' + u.sugarProd + ' üßÇ/—Å';
        if (u.goldProd) stats += ', +' + u.goldProd + ' üíõ/—Å';
        return `<div class="upgrade">
          <div class="upgrade-info">
            <div class="upgrade-name">${u.name} √ó ${count}</div>
            <div class="upgrade-desc">${u.desc}</div>
            <div class="upgrade-stats">${stats}</div>
          </div>
          <button class="upgrade-btn" ${!canBuy ? 'disabled' : ''} onclick="buyUpgrade(upgradesData[${upgrades.indexOf(u)}])">
            ${costStr(cost)}
          </button>
        </div>`;
      }).join('');
    }

    const upgradesData = upgrades;

    function updateUI() {
      document.getElementById('cookies').textContent = format(state.cookies);
      document.getElementById('sugar').textContent = format(state.sugar || 0);
      document.getElementById('gold').textContent = format(state.gold || 0);
      calcPerSec();
      document.getElementById('per-sec').textContent = state.perSec.toFixed(1);
      renderUpgrades();
      const m = getNewbieMultiplier();
      const badge = document.getElementById('newbie-badge');
      if (m > 1) {
        badge.style.display = 'block';
        badge.textContent = 'üöÄ –ë–æ–Ω—É—Å –Ω–æ–≤–∞—á–∫–∞: √ó' + m + ' –¥–æ –≤–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–∞!';
      } else badge.style.display = 'none';
    }

    function gameLoop() {
      const now = Date.now();
      const dt = (now - (state._lastTick || now)) / 1000;
      state._lastTick = now;
      state.cookies += state.perSec * dt;
      state.sugar = (state.sugar || 0) + (state.sugarPerSec || 0) * dt;
      state.gold = (state.gold || 0) + (state.goldPerSec || 0) * dt;
      state.totalEarned = (state.totalEarned || 0) + state.perSec * dt;
      save();
      syncLeaderboard();
      updateUI();
    }

    let lastSync = 0;
    function syncLeaderboard() {
      if (!FIREBASE_URL || Date.now() - lastSync < 5000) return;
      lastSync = Date.now();
      const score = Math.floor(state.cookies);
      try {
        fetch(`${FIREBASE_URL}/players/${userId}.json`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ userName, cookies: score, updatedAt: Date.now() })
        }).catch(() => {});
      } catch(e) {}
    }

    async function loadLeaderboard() {
      const el = document.getElementById('lb-global');
      if (!FIREBASE_URL) {
        el.innerHTML = '<div class="lb-empty">–î–æ–¥–∞–π FIREBASE_URL —É –∫–æ–¥ –¥–ª—è —Ç–æ–ø—É</div>';
        return;
      }
      el.innerHTML = '<div class="lb-empty">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>';
      try {
        const r = await fetch(`${FIREBASE_URL}/players.json?orderBy="cookies"&limitToLast=50`);
        if (!r.ok) throw new Error('fetch');
        const data = await r.json();
        if (!data) { el.innerHTML = '<div class="lb-empty">–ù—ñ—Ö—Ç–æ —â–µ –Ω–µ –≥—Ä–∞–≤. –ë—É–¥—å –ø–µ—Ä—à–∏–º!</div>'; return; }
        let players = Object.entries(data).map(([uid, v]) => ({ uid, ...v }));
        players.sort((a, b) => (b.cookies || 0) - (a.cookies || 0));
        const rankEmoji = ['ü•á', 'ü•à', 'ü•â'];
        el.innerHTML = players.slice(0, 10).map((p, i) => {
          const isMe = p.uid === userId;
          const rk = i < 3 ? `<span class="lb-rank ${['gold','silver','bronze'][i]}">${rankEmoji[i]}</span>` : `<span class="lb-rank">#${i+1}</span>`;
          return `<div class="lb-row${isMe?' me':''}">${rk}<div class="lb-name">${escapeHtml(p.userName||'–ì—Ä–∞–≤–µ—Ü—å')}</div><div class="lb-score">${format(p.cookies||0)} üç™</div></div>`;
        }).join('');
      } catch(e) { el.innerHTML = '<div class="lb-empty">–ù–µ –≤–¥–∞–ª–æ—Å—å –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</div>'; }
    }

    function escapeHtml(s) { return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    function switchTab(tab) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
      document.querySelector(`.tab[onclick*="${tab}"]`).classList.add('active');
      document.getElementById('view-' + tab).classList.add('active');
      if (tab === 'global') loadLeaderboard();
    }

    function init() {
      try {
        const tg = window.Telegram?.WebApp;
        if (tg) {
          tg.ready();
          tg.expand();
          document.body.style.background = tg.themeParams?.bg_color || 'linear-gradient(180deg, #667eea 0%, #764ba2 100%)';
          const u = tg.initDataUnsafe?.user;
          if (u) {
            userId = String(u.id);
            userName = (u.first_name || '–ì—Ä–∞–≤–µ—Ü—å') + (u.last_name ? ' ' + u.last_name[0] + '.' : '');
          }
        }
      } catch(e) {}
      load();
      if (state.fingers === undefined && state.cursors === 0 && state.grandmas === 0) state.fingers = 1;
      state.sugar = state.sugar || 0;
      state.gold = state.gold || 0;
      state.totalEarned = state.totalEarned || state.cookies;
      state.firstPlay = state.firstPlay || Date.now();
      calcPerSec();
      updateUI();
      setInterval(gameLoop, 500);
    }

    init();
  </script>
</body>
</html>
